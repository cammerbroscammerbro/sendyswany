<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>CipherQ | Authentication</title>
  <link rel="icon" href="/favicon-16x16.png" type="image/png" sizes="16x16">
  <link rel="icon" href="/favicon-32x32.png" type="image/png" sizes="32x32">
  <link rel="icon" href="/favicon-64x64.png" type="image/png" sizes="64x64">
  <style>
    *{box-sizing:border-box}
    body{font-family:Inter,system-ui,-apple-system,'Segoe UI',Roboto,Arial,sans-serif;margin:0;
      background:
        radial-gradient(600px 400px at 10% 10%, rgba(124,58,237,0.06), transparent 8%),
        radial-gradient(500px 300px at 90% 90%, rgba(6,182,212,0.05), transparent 12%),
        linear-gradient(180deg,#020617 0%, #070812 60%, #040406 100%);
      color:#e6eef8;min-height:100vh;display:flex;align-items:center;justify-content:center}

    .auth-shell{width:100%;max-width:1100px;padding:36px}
    .auth-wrap{display:grid;grid-template-columns:1fr 420px;gap:36px;align-items:center}

    /* left promo / branding */
    .promo{padding:28px}
    .brand{font-weight:800;font-size:20px;margin-bottom:8px;
      background:linear-gradient(90deg,#7dd3fc,#8b5cf6);-webkit-background-clip:text;background-clip:text;color:transparent;letter-spacing:0.4px}
    .promo h1{font-size:34px;margin-bottom:12px;color:#f8fafc}
    .promo p{color:#9aa6b8;line-height:1.6;margin-top:6px}

    /* auth card */
    .auth-container{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));border:1px solid rgba(255,255,255,0.04);padding:28px;border-radius:14px;box-shadow:0 20px 50px rgba(2,6,12,0.7);backdrop-filter: blur(8px)}
    .auth-container h2{font-size:20px;margin-bottom:16px;color:#e6f5ff}
    .field{width:100%;margin-bottom:12px}
    input{width:100%;padding:12px;background:transparent;border:1px solid rgba(255,255,255,0.04);border-radius:10px;color:#e6eef8}
    input::placeholder{color:#8f9aa8}
    input:focus{outline:none;border-color:#7dd3fc;box-shadow:0 8px 30px rgba(11,103,255,0.06)}

    .btn{width:100%;padding:12px;border-radius:10px;border:0;background:linear-gradient(90deg,#06b6d4,#7c3aed);color:white;font-weight:700;cursor:pointer;transition:transform .12s,box-shadow .12s}
    .btn:hover{transform:translateY(-2px);box-shadow:0 8px 24px rgba(124,58,237,0.18)}
    .btn.secondary{background:transparent;border:1px solid rgba(255,255,255,0.06);color:#cfe8ff}
    .social{display:flex;gap:12px;margin-top:12px}
    .social .google-btn{flex:1;padding:10px;border-radius:10px;border:1px solid rgba(255,255,255,0.03);background:linear-gradient(180deg,rgba(255,255,255,0.02),rgba(255,255,255,0.01));display:flex;align-items:center;justify-content:center;gap:10px;color:#dbe7ff}
    .toggle{margin-top:12px;color:#98a6b8;cursor:pointer;text-align:center}
    .toggle:hover{color:#7dd3fc}
    .error{color:#ff7b7b;font-size:13px;margin-top:10px;text-align:center}

    @media (max-width:900px){
      .auth-wrap{grid-template-columns:1fr}
      .auth-shell{padding:18px}
    }
  </style>
</head>
<body>
  <div class="auth-shell">
    <div class="auth-wrap">
      <div class="promo">
        <div class="brand">CipherQ</div>
        <h1>Secure access to CipherQ</h1>
        <p>Sign in to manage API keys, view usage, and access post-quantum encryption services. Fast, secure, and trusted.</p>
      </div>

      <div class="auth-container">
        <h2 id="formTitle">Login</h2>
        <div class="field"><input type="email" id="email" placeholder="Email"></div>
        <div class="field"><input type="password" id="password" placeholder="Password"></div>
        <button class="btn" id="authBtn">Login</button>

        <div class="social">
          <button class="google-btn" id="googleBtn">
            <img src="https://upload.wikimedia.org/wikipedia/commons/5/53/Google_%22G%22_Logo.svg" alt="Google Logo" style="width:18px;height:18px">
            <span>Continue with Google</span>
          </button>
        </div>

        <div class="toggle" id="toggleForm">Don't have an account? Sign Up</div>
        <div class="error" id="error"></div>
      </div>
    </div>
  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-app.js";
    import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, GoogleAuthProvider, signInWithPopup } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-auth.js";

    const firebaseConfig = {
      apiKey: "AIzaSyAqzy8ivw9QZG6RXNQmoTKAWY_1uunTTrw",
      authDomain: "pcq-api.firebaseapp.com",
      databaseURL: "https://pcq-api-default-rtdb.firebaseio.com",
      projectId: "pcq-api",
      storageBucket: "pcq-api.firebasestorage.app",
      messagingSenderId: "759573347127",
      appId: "1:759573347127:web:2e89d43e000b4df57838b2",
      measurementId: "G-RTT59R8JBW"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const provider = new GoogleAuthProvider();

    const authBtn = document.getElementById("authBtn");
    const toggleForm = document.getElementById("toggleForm");
    const formTitle = document.getElementById("formTitle");
    const errorBox = document.getElementById("error");
    const googleBtn = document.getElementById("googleBtn");

    let isLogin = true;

    toggleForm.addEventListener("click", () => {
      isLogin = !isLogin;
      formTitle.textContent = isLogin ? "Login" : "Sign Up";
      authBtn.textContent = isLogin ? "Login" : "Sign Up";
      toggleForm.textContent = isLogin
        ? "Don't have an account? Sign Up"
        : "Already have an account? Login";
      errorBox.textContent = "";
    });

    authBtn.addEventListener("click", async () => {
      const email = document.getElementById("email").value;
      const password = document.getElementById("password").value;
      errorBox.textContent = "";

      try {
        let userCredential;
        if (isLogin) {
          userCredential = await signInWithEmailAndPassword(auth, email, password);
        } else {
          userCredential = await createUserWithEmailAndPassword(auth, email, password);
        }

        // Persist minimal user info for the dashboard
        try {
          const uid = userCredential.user && userCredential.user.uid ? userCredential.user.uid : null;
          const userEmail = userCredential.user && userCredential.user.email ? userCredential.user.email : email;
          if (uid) {
            localStorage.setItem('cipherq_uid', uid);
            localStorage.setItem('cipherq_email', userEmail);
          }
        } catch (e) {
          // localStorage may fail in some privacy modes; ignore silently
          console.warn('Could not persist user info', e);
        }

  window.location.href = "dashbord.html";
      } catch (err) {
        errorBox.textContent = err.message.replace("Firebase:", "");
      }
    });

    googleBtn.addEventListener("click", async () => {
      try {
        const result = await signInWithPopup(auth, provider);

        // Persist minimal user info for the dashboard
        try {
          const uid = result.user && result.user.uid ? result.user.uid : null;
          const userEmail = result.user && result.user.email ? result.user.email : '';
          if (uid) {
            localStorage.setItem('cipherq_uid', uid);
            if (userEmail) localStorage.setItem('cipherq_email', userEmail);
          }
        } catch (e) {
          console.warn('Could not persist user info', e);
        }

  window.location.href = "dashbord.html";
      } catch (err) {
        errorBox.textContent = err.message.replace("Firebase:", "");
      }
    });
  </script>
</body>
</html>

